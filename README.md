# Docker Base Image for Trivadis Engineering
Docker base image used for miscellaneous Oracle Directory Service engineering .

## Content

This docker image is based on the official Oracle Linux slim image ([oraclelinux](https://hub.docker.com/r/_/oraclelinux/)). It has been extended with the following Linux packages and configuration:

* Upgrade of all installed packages to the latest release (yum upgrade)
* Install the following additional packages including there dependencies:

    * *hostname* Utility to set/show the host name or domain name
    * *which* Displays where a particular program in your path is located
    * *unzip* A utility for unpacking zip files
    * *zip* A file compression and packaging utility compatible with PKZIP
    * *tar* A GNU file archiving program
    * *gzip* The GNU data compression program
    * *procps-ng* System and process monitoring utilities
* Dedicated groups for user *oracle*, oinstall (gid 1000), osdba (gid 1010), osoper (gid 1020), osbackupdba (gid 1030), oskmdba (gid 1040), osdgdba (gid 1050)
* Operating system user *oracle* (uid 1000)
* Add oracle to the sudoers *ALL=(ALL)*
* Oracle Inventory file *oraInst.loc* in *$ORACLE_DATA/etc/oraInst.loc*
* Generic ResponseFile *install.rsp* in *$ORACLE_DATA/etc/install.rsp* used for OUD and FMW installations
* Create of Oracle OFA Directories see below
* Install OUD Base environment scripts from (www.oradba.ch) 

The purpose of this image is provide base image for other docker images for OUD Directory, Proxy Server or OUDSM. The following docker images are based on this images or build with similar structures.

   * [oehrlis/docker-oud](https://github.com/oehrlis/docker-oud)
   * [oehrlis/docker-oudsm](https://github.com/oehrlis/docker-oudsm)
   * [oehrlis/docker-odsee](https://github.com/oehrlis/docker-odsee)

### Environment Variable and Directories
The following environment variable have been used for the installation. In particular it is possible to modify the variables ORACLE_ROOT, ORACLE_DATA and ORACLE_BASE via *build-arg* during image build to have a different directory structure. All other parameters are only relevant for the creation of the container. They may be modify via `docker run` environment variables.

Environment variable | Value / Directories                    | Modifiable   | Comment
-------------------- | -------------------------------------- | -------------| ---------------
ORACLE_ROOT          | `/u00`                                 | docker build | Root directory for all the Oracle software
ORACLE_BASE          | `$ORACLE_ROOT/app/oracle`              | docker build | Oracle base directory
n/a                  | `$ORACLE_BASE/product`                 | no           | Oracle product base directory
ORACLE_HOME_NAME     | `fmw12.2.1.3.0`                        | no           | Name of the Oracle Home, used to create to PATH to ORACLE_HOME eg. *$ORACLE_BASE/product/$ORACLE_HOME_NAME*
ORACLE_DATA          | `/u01`                                 | docker build | Root directory for the persistent data eg. OUD instances, OUDSM domain etc. A docker volumes must be defined for */u01*
INSTANCE_BASE        | `$ORACLE_DATA/instances`               | no           | Base directory for OUD instances
OUD_INSTANCE         | `oud_docker`                           | docker run   | Default name for OUD instance
OUD_INSTANCE_HOME    | `${INSTANCE_BASE}/${OUD_INSTANCE}` | docker run   |
CREATE_INSTANCE      | `TRUE`                                 | docker run   | Flag to create OUD instance on first start of the container
OUD_PROXY            | `FALSE`                                | docker run   | Flag to create proxy instance. Not yet implemented.
OUD_INSTANCE_INIT    | `$ORACLE_DATA/scripts`                 | docker run   | Directory for the instance configuration scripts
LDAP_PORT            | `1389`                                 | docker run   | Default LDAP port for the OUD instance
LDAPS_PORT           | `1636`                                 | docker run   | Default LDAPS port for the OUD instance
REP_PORT             | `8989`                                 | docker run   | Default replication port for the OUD instance
ADMIN_PORT           | `4444` or `7001`                       | docker run   | Default admin port for the OUD instance (4444) or the OUDSM domain (7001)
ADMIN_SSLPORT        | `7002`                                 | docker run   | Default admin SSL port for the OUDSM domain
ADMIN_USER           | `cn=Directory Manager` or `weblogic`   | docker run   | Default admin user for OUD instance or OUDSM domain
ADMIN_PASSWORD       |  n/a                                   | docker run   | No default password. Password will be autogenerated when not defined.
BASEDN               | `dc=postgasse,dc=org`                  | docker run   | Default directory base DN
SAMPLE_DATA          | `TRUE`                                 | docker run   | Flag to load sample data. Not yet implemented.
DOMAIN_BASE          | `$ORACLE_DATA/domains`                 | no           | Base directory for OUDSM domain
DOMAIN_NAME          | `oudsm_domain`                         | docker run   | Default name for OUDSM domain
DOMAIN_HOME          | `${DOMAIN_BASE}/${DOMAIN_NAME}`        | docker run   | Default OUDSM domain home directory
CREATE_DOMAIN        | `TRUE`                                 | docker run   | Flag to create OUDSM domain on first start of the container
ETC_BASE             | `$ORACLE_DATA/etc`                     | no           | Oracle etc directory with configuration files
LOG_BASE             | `$ORACLE_DATA/log`                     | no           | Oracle log directory with log files
DOWNLOAD             | `/tmp/download`                        | no           | Temporary download directory, will be removed after build
DOCKER_BIN           | `/opt/docker/bin`                      | no           | Docker build and setup scripts
JAVA_DIR             | `/usr/java`                            | no           | Base directory for java home location
JAVA_HOME            | `$JAVA_DIR/jdk1.8.0_152`               | no           | Java home directory

In general it does not make sense to change all possible variables. Although *BASEDN* and *ADMIN_PASSWORD* are good candidates for customization.

### Scripts to Build and Setup
The following scripts are used either during Docker image build or while setting up and starting the container.

| Script                    | Purpose
| ------------------------- | ----------------------------------------------------------------------------
| `buildDockerImage.sh`       | Build helper script for docker OUD and OUDSM images
| `check_OUD_Instance.sh`     | Check the status of the OUD instance for Docker HEALTHCHECK
| `config_OUD_Instance.sh`    | Configure OUD instance using custom scripts
| `create_OUDSM.py`          | Phyton script to create OUDSM Domain
| `create_OUDSM_Domain.sh`    | Script to create the OUDSM domain
| `create_OUD_Instance.sh`    | Script to create the OUD instance
| `setup_java.sh`            | Setup script for OS update and Java installation when creating Docker images
| `setup_oud.sh`            | Setup script for OUD standalone installation when creating Docker images
| `setup_oudbase.sh`        | Setup script for the Oracle environment when creating Docker images
| `setup_oudsm.sh`          | Setup script for OUD collocated installation when creating Docker images
| `start_OUDSM_Domain.sh`   | Script to start the OUD instance
| `start_OUD_Instance.sh`   | Script to start the OUDSM domain

## Installation and build
The docker image can be build manually based on [oehrlis/docker-tvd](https://github.com/oehrlis/docker-oudbase) from GitHub or pull from the public repository [oehrlis/oudbase](https://hub.docker.com/r/oehrlis/oudbase/) on DockerHub.

* Manual build the image based on the source from GitHub ([oehrlis/docker-tvd](https://github.com/oehrlis/docker-tvd)).

        docker build -t oehrlis/oudbase .

* Pull the image from Docker hub.

        docker pull oehrlis/oudbase

* Create a new named container and run it interactive (-i -t)

        docker run -v [<host mount point>:]/u01 -h oudbase --name OUD-engineering oehrlis/oudbase
        docker start -ai OUD-engineering

## Issues
Please file your bug reports, enhancement requests, questions and other support requests within [Github's issue tracker](https://help.github.com/articles/about-issues/):

* [Existing issues](https://github.com/oehrlis/docker-tvd/issues)
* [submit new issue](https://github.com/oehrlis/docker-tvd/issues/new)

## License
docker-oud is licensed under the Apache License, Version 2.0. You may obtain a copy of the License at <http://www.apache.org/licenses/LICENSE-2.0>.

To download and run Oracle Unifified Directory , regardless whether inside or outside a Docker container, you must download the binaries from the Oracle website and accept the license indicated at that page. See [OTN Developer License Terms](http://www.oracle.com/technetwork/licenses/standard-license-152015.html) and [Oracle Database Licensing Information User Manual](https://docs.oracle.com/database/122/DBLIC/Licensing-Information.htm#DBLIC-GUID-B6113390-9586-46D7-9008-DCC9EDA45AB4)
